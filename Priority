package EnderGrant;

import net.luckperms.api.LuckPerms;
import net.luckperms.api.model.user.User;
import org.bukkit.entity.Player;
import org.bukkit.plugin.Plugin;

import java.util.List;

public class Priority {

    private final Plugin plugin;
    private final Player player;
    private final LuckPerms luckPerms;
    private final String newIndex;

    public Priority(Plugin plugin, Player player, String newIndex) {
        this.plugin = plugin;
        this.player = player;
        this.luckPerms = plugin.getServer().getServicesManager().load(LuckPerms.class);
        this.newIndex = newIndex;
    }

    public String getGroupName(Player player) {
        User user = luckPerms.getUserManager().getUser(player.getUniqueId());
        if (user != null) {
            return user.getPrimaryGroup();
        }
        return "default";
    }

    public boolean handleDonationDrop() {
        List<String> priorityList = plugin.getConfig().getStringList("grant_priorities");
        String playerIndex = getGroupName(player);

        int intIndexPlayer = getPriorityIndex(priorityList, playerIndex);
        int newIndexPlayer = getPriorityIndex(priorityList, newIndex);

        return intIndexPlayer < newIndexPlayer;
    }

    private int getPriorityIndex(List<String> priorityList, String group) {
        for (String entry : priorityList) {
            String[] parts = entry.split(";");
            if (parts[0].equalsIgnoreCase(group)) {
                return Integer.parseInt(parts[1]);
            }
        }
        return -1;
    }
}
